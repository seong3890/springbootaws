<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link th:href="@{/css/bootstrap.css}" rel="stylesheet">
    <meta charset="UTF-8">
    <title>주문리스트</title>
</head>
<body>
<div class="container">
    <div class="container p-5 my-5 bg-dark text-white text-center ">
        <h2>주문리스트</h2>
    </div>
    <div>
        <form th:object="${orderSearch}" class="form-check-inline">
            <input type="text" th:field="*{nickname}" placeholder="닉네임" class="form-control">
            <select class="form-select" th:field="*{orderStatus}">
                <option value="">주문상태</option>
                <option th:each="status : ${T(com.springbootaws.domain.order.OrderStatus).values()}"
                        th:value="${status}" th:text="${status}">
                </option>
            </select>

            <button type="submit" class="btn btn-primary">검색</button>
        </form>
    </div>
    <div>
        <h2>주문 목록</h2>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>번호</th>
                <th>회원명</th>
                <th>상품명</th>
                <th>주문가격</th>
                <th>주문수량</th>
                <th>상태</th>
                <th>일시</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${order}">
                <td th:text="${item.id}"></td>
                <td th:text="${item.nickname}"></td>
                <td th:text="${item.orderLists[0].name}"></td>
                <td th:text="${item.orderLists[0].orderPrice}"></td>
                <td th:text="${item.orderLists[0].count}"></td>
                <td th:text="${item.orderStatus}"></td>
                <td th:text="${item.createTime}"></td>
                <td>
                    <a th:if="${item.orderStatus.name()} == 'ORDER'" th:href="'javascript:cancel('+${item.id}+')'" class="btn btn-danger">취소</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- 페이징 -->
    <div class="row">
        <div class="col">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${order != null and order.hasPrevious()} ? '' : 'disabled'">
                        <a class="page-link" th:href="|@{/orders(page=${order != null ? order.number - 1 : 0})}|"
                           th:if="${order != null and order.hasPrevious()}">Previous</a>
                    </li>
                    <li class="page-item" th:each="pageNum : ${order != null ? #numbers.sequence(0, order.totalPages - 1) : {}}"
                        th:classappend="${order != null and pageNum == order.number} ? 'active'">
                        <a class="page-link" th:href="|@{/orders(page=${pageNum})}|" th:text="${pageNum + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${order != null and order.hasNext()} ? '' : 'disabled'">
                        <a class="page-link" th:href="|@{/product/book(page=${order != null ? order.number + 1 : 0})}|"
                           th:if="${order != null and order.hasNext()}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
<script th:src="@{/static/js/bootstrap.js}"></script>
<script th:src="@{/js/jquery-3.6.3.min.js}"></script>
<script>
    function cancel(id){
      let form= document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", "/orders/" + id + "/cancel");
        document.body.appendChild(form);
        form.submit();
    }
</script>

</body>
</html>